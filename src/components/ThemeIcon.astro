---
import { Icon } from 'astro-icon'

const darkModeColor = '#ff0080';
const lightModeColor = '#0000FF';
---

<button
  id="themeToggle"
  aria-label="Switch between light and dark mode"
>
  <Icon name="lucide:lightbulb-off" size="24" />
  <Icon name="lucide:lightbulb" size="24" />
</button>

<style define:vars={{ lightModeColor, darkModeColor }}>
  #themeToggle {
    cursor: pointer;
  }

  #themeToggle:hover,
  #themeToggle:focus {
    outline: 2px dotted var(--primary-color);
  }

  [astro-icon="lucide:lightbulb"] {
    display: none;
    transition: 0.2s;
  }

  [astro-icon="lucide:lightbulb-off"] {
    display: block;
    transition: 0.2s;
  }

  :global(.dark) [astro-icon="lucide:lightbulb"] {
    display: block;
  }
  :global(.dark) [astro-icon="lucide:lightbulb-off"] {
    display: none;
  }

  [astro-icon] {
        color: black;
    }

  [astro-icon="lucide:lightbulb"] {
        color: white;
  }

  button {
    height: 48px;
    width: 48px;
    padding: 0 !important;
    display: flex;
    align-items: center;
    justify-content: center;
    /* background: none !important;
    box-shadow: none !important;
    transform: none !important; */
  }
</style>

<script>
  const theme = (() => {
    if (
      typeof localStorage !== 'undefined' &&
      localStorage.getItem('theme')
    ) {
      return localStorage.getItem('theme');
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    document.documentElement.classList.add('dark');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle('dark');

    const isDark = element.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  document
    .getElementById('themeToggle')
    .addEventListener('click', handleToggleClick);
  document
    .getElementById('themeToggle')
    .addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        handleToggleClick();
      }
    });
</script>
